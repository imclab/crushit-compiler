$(function(){"use strict";var myCodeMirror,App,display=$("#console"),terminalHandle=null;App={el:$("#left-panel"),active:!1,blinking:!1,showingError:!1,update:function(data){myCodeMirror.setValue(data)},initialize:function(){var self=this;self.el.on("init",function(){self.initialize()}).on("loading",function(){self.loading()}).on("loaded",function(){self.loaded()}).on("error",function(){self.onError()}),$("#crushit").on("submit",function(e){self.crushIt(e)}),$("#url").on("focus",function(){return self.active?(console.log("active"),!1):(document.forms.crushit.reset(),self.update(""),void self.switchOfBlinker())}).on("blur",function(){$("#url").val()||self.active||self.blink()}),$("#max").on("change",function(){self.onOptionsChange("max")}),$("#mangle").on("change",function(){self.onOptionsChange("mangle")}),$("#comments").on("change",function(){self.onOptionsChange("comments")}),$("#beautify").on("change",function(){self.onOptionsChange("beautify")}),self.blink()},crushIt:function(e){if(e.preventDefault(),this.active)return!1;var self=this,url=self.el.find("#url").val(),query=self.el.find("#crushit").serialize();self.runTerminal(url,function(){self.el.trigger("loading"),self.sendRequest("/crush",query,"text",url)})},sendRequest:function(url,data,format){var self=this;$.post(url,data,format).done(function(code){self.update(code),self.el.trigger("loaded")}).fail(function(xhr){self.update(xhr.responseText),self.el.trigger("error")})},loading:function(){this.showingError&&(this.showingError=!1,display.removeClass("error")),$("#loading").removeClass("loading-inactive").addClass("loading-active"),this.active=!0},loaded:function(){this.reset()},reset:function(){this.el.find("#submit").removeClass("disabled").attr("disabled",!1),$("#loading").removeClass("loading-active").addClass("loading-inactive"),this.active=!1},onError:function(){display.addClass("error"),this.showingError=!0,this.reset()},onOptionsChange:function(box){var mm=this.el.find("#max, #mangle"),bc=this.el.find("#comments, #beautify");!$("#max").is(":checked")&&!$("#mangle").is(":checked")||"comments"!==box&&"beautify"!==box||mm.attr("checked",!1),!$("#comments").is(":checked")&&!$("#beautify").is(":checked")||"max"!==box&&"mangle"!==box||(bc.attr("checked",!1),"mangle"!==box||$("#max").is(":checked")||this.el.find("#max").attr("checked",!0))},runTerminal:function(url,next){var command=this.getCommand(url),terminal=this.el.find("#crushit-command");terminal.text(""),$({count:0}).animate({count:command.length},{duration:2e3,step:function(){terminal.text(command.substring(0,Math.round(this.count)))}}).promise().done(next)},getCommand:function(url){var command="crushit ";return command+=$("#max").is(":checked")&&$("#mangle").is(":checked")?"-xm "+url:$("#max").is(":checked")?"-x "+url:$("#beautify").is(":checked")&&$("#comments").is(":checked")?"-bc "+url:$("#beautify").is(":checked")?"-b "+url:$("#comments").is(":checked")?"-c "+url:url},blink:function(){if(this.blinking||this.active)return!1;var terminal=$("#crushit-command"),on=!1;this.blinking=!0,terminalHandle=setInterval(function(){on?(terminal.text(""),on=!1):(terminal.text("_"),on=!0)},500)},switchOfBlinker:function(){clearInterval(terminalHandle),$("#crushit-command").text(""),this.blinking=!1}},App.initialize(),myCodeMirror=CodeMirror.fromTextArea(document.getElementById("console"),{lineNumbers:!0,mode:"text/javascript",tabMode:"indent",matchBrackets:!0,lineWrapping:!0,readOnly:!0,indentUnit:4}),myCodeMirror.setSize("100%","100%")});