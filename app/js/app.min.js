$(function(){"use strict";var App,display=$("#console"),terminalHandle=null;App={el:$("#left-panel"),active:!1,blinking:!1,showingError:!1,update:function(data){display.val(data)},initialize:function(){var self=this;self.el.on("init",function(){self.initialize()}).on("loading",function(){self.loading()}).on("loaded",function(){self.loaded()}).on("error",function(){self.onError()}),$("#crushit").on("submit",function(e){self.crushIt(e)}),$("#url").on("focus",function(){return self.active?(console.log("active"),!1):(document.forms.crushit.reset(),self.update(""),void self.switchOfBlinker())}).on("blur",function(){$("#url").val()||self.active||self.blink()}),$("#max").on("change",function(){self.onOptionsChange("max")}),$("#comments").on("change",function(){self.onOptionsChange("comments")}),$("#beautify").on("change",function(){self.onOptionsChange("beautify")}),self.blink()},crushIt:function(e){if(e.preventDefault(),this.active)return!1;var self=this,url=self.el.find("#url").val(),query=self.el.find("#crushit").serialize();self.runTerminal(url,function(){self.el.trigger("loading"),self.sendRequest("/crush",query,"text",url)})},sendRequest:function(url,data,format){var self=this;$.post(url,data,format).done(function(code){self.update(code),self.el.trigger("loaded")}).fail(function(xhr){self.update(xhr.responseText),self.el.trigger("error")})},loading:function(){this.showingError&&(this.showingError=!1,display.removeClass("error")),this.update("Crushing scripts...."),$("#loading").removeClass("loading-inactive").addClass("loading-active"),this.active=!0},loaded:function(){this.reset()},reset:function(){this.el.find("#submit").removeClass("disabled").attr("disabled",!1),$("#loading").removeClass("loading-active").addClass("loading-inactive"),this.active=!1},onError:function(){display.addClass("error"),this.showingError=!0,this.reset()},onOptionsChange:function(box){"max"===box&&this.el.find("#comments, #beautify").attr("checked",!1),!$("#max").is(":checked")||"comments"!==box&&"beautify"!==box||this.el.find("#max").attr("checked",!1)},runTerminal:function(url,next){var command=this.getCommand(url),terminal=this.el.find("#crushit-command");terminal.text(""),$({count:0}).animate({count:command.length},{duration:2e3,step:function(){terminal.text(command.substring(0,Math.round(this.count)))}}).promise().done(next)},getCommand:function(url){var command="crushit ";return command+=$("#max").is(":checked")?"-m "+url:$("#beautify").is(":checked")&&$("#comments").is(":checked")?"-bc "+url:$("#beautify").is(":checked")?"-b "+url:$("#comments").is(":checked")?"-c "+url:url},blink:function(){if(this.blinking||this.active)return!1;var terminal=$("#crushit-command"),on=!1;this.blinking=!0,terminalHandle=setInterval(function(){on?(terminal.text(""),on=!1):(terminal.text("_"),on=!0)},500)},switchOfBlinker:function(){clearInterval(terminalHandle),$("#crushit-command").text(""),this.blinking=!1}},App.initialize()});