$(function(){"use strict";var App,el=$("#left-panel"),console=$("#console");App={active:!1,showingError:!1,terminalHandle:null,events:function(){var self=this;el.on("submit","#crushit",function(e){self.crushIt(e)}).on("focus","#url",function(e){self.onUrlFocus(e)}).on("blur","#url",function(e){self.onUrlBlur(e)}).on("change","#max",function(e){self.onOptionsChange(e)}).on("change","#comments",function(e){self.onOptionsChange(e)}).on("change","#beautify",function(e){self.onOptionsChange(e)}).on("init",function(){self.initialize()}).on("loading",function(){self.loading()}).on("loaded",function(){self.loaded()}).on("error",function(){self.onError()})},update:function(data){console.val(data)},initialize:function(){var self=this;self.events(),self.blink()},crushIt:function(e){if(e.preventDefault(),this.active)return!1;el.trigger("init");var self=this,url=el.find("#url").val(),query=el.find("#crushit").serialize();self.switchOfBlinker(),self.runTerminal(url,function(){el.trigger("loading"),self.sendRequest("/crush",query,"text",url)})},sendRequest:function(url,data,format){var self=this;$.post(url,data,format).done(function(code){self.update(code),el.trigger("loaded")}).fail(function(xhr){el.trigger("error"),self.update(xhr.responseText)})},loading:function(){this.showingError&&(console.removeClass("error"),this.showingError=!1),this.update("Crushing scripts...."),$("#loading").removeClass("loading-inactive").addClass("loading-active"),this.active=!0},init:function(){el.find("#submit").addClass("disabled").attr("disabled","disabled"),this.active=!0},loaded:function(){this.reset()},reset:function(){el.find("#submit").removeClass("disabled").attr("disabled",!1),$("#loading").removeClass("loading-active").addClass("loading-inactive"),this.active=!1},onError:function(){console.addClass("error"),this.showingError=!0,this.reset()},onUrlFocus:function(){return this.active?!1:(el.find("#url").val(""),this.update(""),void this.switchOfBlinker())},onUrlBlur:function(){$("#url").val()||this.active||this.blink()},onOptionsChange:function(){$("#max").is(":checked")&&el.find("#comments, #beautify").attr("checked",!1)},runTerminal:function(url,next){var command=this.getCommand(url),terminal=el.find("#crushit-command");terminal.text(""),$({count:0}).animate({count:command.length},{duration:2e3,step:function(){terminal.text(command.substring(0,Math.round(this.count)))}}).promise().done(next)},getCommand:function(url){var command="crushit ";return command+=$("#max").is(":checked")?"-m "+url:$("#beautify").is(":checked")&&$("#comments").is(":checked")?"-bc "+url:$("#beautify").is(":checked")?"-b "+url:$("#comments").is(":checked")?"-c "+url:url},blink:function(){var self=this,terminal=el.find("#crushit-command"),on=!1;self.terminalHandle=setInterval(function(){on?(terminal.text(""),on=!1):(terminal.text("_"),on=!0)},500)},switchOfBlinker:function(){clearInterval(this.terminalHandle),this.terminalHandle=null,el.find("#crushit-command").text("")}},App.initialize()});